# Windows Themepack Repackager

This is a bash script that adds a branding image to a Windows themepack file and puts it in a zip file with a preview image. It also fixes the theme so that when installed, the resulting theme folder is not just the first eight characters of the theme's name, preventing clobbers with themes that have the same prefix.

This was originally developed for packaging themes to post on [DeviantArt](http://tpenguinltg.deviantart.com/).

## Requirements

The following programs must be in your `$PATH`:

* [`cabextract`](http://www.cabextract.org.uk/), for extracting the themepacks
* [`lcab`](http://ohnopub.net/~ohnobinki/lcab/), for repackaging the themepacks
* [`zip`](http://www.info-zip.org/Zip.html), for zipping up the final product

Additionally, the script will look for the following files:

* `${WINTHEME_RAW_PATH}/${theme_name}.themepack` or `${WINTHEME_RAW_PATH}/${theme_name}.deskthemepack`
* `${WINTHEME_PREVIEW_PATH}/${theme_name}.png`
* `${WINTHEME_BRANDING_FILE}`

where:

* `${theme_name}` is the name of the theme (generally the value of `DisplayName` of the `[Theme]` section of the `.theme` file). This cannot be overridden.
* `${WINTHEME_RAW_PATH}` defaults to `./raw`
* `${WINTHEME_PREVIEW_PATH}` defaults to `./previews`
* `${WINTHEME_BRANDING_FILE}` defaults to `branding.png`

The last of those three can be overwridden by setting the appropriate environment variable.

A `colors` folder in the current directory is also required to write the theme's Windows Classic colors to a file. There is currently no way to override this path. If this folder is not present, then a colors file will not be written for the theme and a harmless error will be generated by bash.

## Output

This script does not delete files that were extracted from the themepack nor the files that were zipped up in case you want to make manual changes. To remove these temporary files, use the `-c` flag documented below.

The main file is a zip file in the current directory.

For example, for a theme called "[Hotdog Stand](http://fav.me/d8oxku6)", the following files will be generated:

    .
    |-- colors
    |   `-- Hotdog Stand.txt
    |-- Hotdog Stand
    |   |-- Hotdog Stand.themepack
    |   `-- preview.png
    |-- Hotdog Stand.zip
    |-- raw
        `-- Hotdog Stand
            |-- Hotdog Stand.themepack
            `-- sources
                |-- Hotdog Stand.theme
                `-- branding.png

## Usage

    wintheme-package [OPTIONS] -- "Theme name 1" ["Theme name 2" [...]]

## Options
<dl>
  <dt><code>-a</code></dt>
  <dd>Package packageable themes (u for unpackaged).</dd>
  <dt><code>-c PACKAGE</code></dt>
  <dd>Clean package. Pass for each package to clean.</dd>
  <dt><code>-h</code></dt>
  <dd>Show this help message.</dd>
  <dt><code>-f</code></dt>
  <dd>Clean each package before building (f for force).</dd>
  <dt><code>-l</code></dt>
  <dd>List unpackaged themes. Packageable themes will have a \* at the end of their names.</dd>
  <dt><code>--</code></dt>
  <dd>Stop processing options.</dd>
</dl>

## TODO

* Make directory structure cleaner
    * Add variables for output path and colors path
    * Do all work in a temporary directory
* Add flags to make preview and branding files optional
